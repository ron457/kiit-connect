rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Public read access for all users (students, parents, delegates)
    // Only authenticated admin can write
    match /personnel/{document} {
      allow read: if true;  // Anyone can view personnel directory
      allow write: if request.auth != null 
                   && request.auth.token.email == 'riddhipdas@gmail.com';
    }
    
    match /locations/{document} {
      allow read: if true;  // Anyone can view campus locations
      allow write: if request.auth != null 
                   && request.auth.token.email == 'riddhipdas@gmail.com';
    }
    
    match /analytics/{document} {
      allow read: if request.auth != null 
                  && request.auth.token.email == 'riddhipdas@gmail.com';
      allow write: if true;  // Allow anonymous usage tracking
    }
    
    // Catch-all: read-only for everything else
    match /{document=**} {
      allow read: if true;
      allow write: if request.auth != null 
                   && request.auth.token.email == 'riddhipdas@gmail.com';
    }
  }
}
